<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test Form Submission</title>
    <style>
        body { font-family: Arial; padding: 2rem; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        form { display: flex; flex-direction: column; gap: 1rem; }
        input, textarea, select { padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-family: Arial; }
        button { padding: 0.75rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
        button:hover { background: #5568d3; }
        .response { margin-top: 2rem; padding: 1rem; background: #f9f9f9; border-radius: 4px; border: 1px solid #ddd; }
        .response h3 { margin-top: 0; color: #333; }
        .response pre { overflow-x: auto; background: #f0f0f0; padding: 0.75rem; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; padding: 1rem; border-radius: 4px; margin-top: 1rem; }
        .error { background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 4px; margin-top: 1rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Form Submission (Without Login)</h1>
        <p>This form tests the PostController JSON response directly.</p>
        
        <form id="testForm">
            <input type="hidden" name="action" value="create">
            
            <input type="text" name="title" placeholder="Title" required value="Test Post">
            <input type="number" name="category_id" value="1">
            <textarea name="description" placeholder="Description" required>Test description</textarea>
            <input type="number" name="price" placeholder="Price" required value="5000000">
            <input type="number" name="area" placeholder="Area" value="50">
            <input type="text" name="address" placeholder="Address" required value="Test Address">
            <input type="text" name="district" placeholder="District" value="District 1">
            <input type="text" name="city" placeholder="City" value="HCMC">
            <select name="room_type">
                <option value="single">Single</option>
                <option value="shared">Shared</option>
                <option value="apartment">Apartment</option>
            </select>
            <input type="number" name="max_people" value="2">
            <select name="gender">
                <option value="any">Any</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
            
            <button type="submit">Submit Form</button>
        </form>
        
        <div id="response"></div>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const responseDiv = document.getElementById('response');
            
            try {
                console.log('Sending request...');
                const response = await fetch('Controllers/PostController.php', {
                    method: 'POST',
                    body: formData
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                const text = await response.text();
                console.log('Raw response:', text);
                
                try {
                    const data = JSON.parse(text);
                    console.log('Parsed JSON:', data);
                    
                    responseDiv.innerHTML = `
                        <div class="response">
                            <h3>Response (JSON)</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                            ${data.success ? '<div class="success">✓ Request successful!</div>' : '<div class="error">✗ Request failed: ' + data.message + '</div>'}
                        </div>
                    `;
                } catch (e) {
                    console.error('JSON parse error:', e);
                    responseDiv.innerHTML = `
                        <div class="response error">
                            <h3>JSON Parse Error</h3>
                            <p>Response is not valid JSON</p>
                            <pre>${text.substring(0, 500)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                responseDiv.innerHTML = `<div class="response error"><h3>Error:</h3><p>${error.message}</p></div>`;
            }
        });
    </script>
</body>
</html>
